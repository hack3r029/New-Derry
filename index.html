<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT: THE TERROR BENEATH DERRY 3D</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', Courier, monospace; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; text-shadow: 2px 2px #000; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border: 1px solid rgba(255,255,255,0.5); border-radius: 50%; transform: translate(-50%, -50%); }
        #instructions { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); color: white; display: flex; 
            flex-direction: column; justify-content: center; align-items: center; 
            text-align: center; z-index: 100; cursor: pointer;
        }
        h1 { color: red; font-size: 3em; margin-bottom: 0.5em; letter-spacing: 5px; }
        .bar-container { width: 200px; height: 10px; border: 1px solid white; margin-top: 10px; }
        #sanity-bar { width: 100%; height: 100%; background: red; transition: width 0.3s; }
        #flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: red; opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div id="instructions">
        <h1>IT: THE TERROR</h1>
        <p>COLETE OS 5 BARQUINHOS NOS ESGOTOS</p>
        <p>N√ÉO DEIXE ELE CHEGAR PERTO</p>
        <button style="padding: 15px 30px; background: red; color: white; border: none; cursor: pointer; font-family: inherit;">ENTRAR NO ESGOTO</button>
    </div>

    <div id="ui">
        <div>BARQUINHOS: <span id="items">0</span>/5</div>
        <div>SANIDADE:</div>
        <div class="bar-container"><div id="sanity-bar"></div></div>
    </div>

    <div id="crosshair"></div>
    <div id="flash"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- CONFIGURA√á√ÉO B√ÅSICA ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020202);
        scene.fog = new THREE.FogExp2(0x020202, 0.15);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        const controls = new PointerLockControls(camera, document.body);
        const instructions = document.getElementById('instructions');

        instructions.addEventListener('click', () => {
            controls.lock();
        });

        controls.addEventListener('lock', () => instructions.style.display = 'none');
        controls.addEventListener('unlock', () => instructions.style.display = 'flex');

        // --- ILUMINA√á√ÉO (Lanterna) ---
        const lantern = new THREE.SpotLight(0xffffff, 50);
        lantern.angle = Math.PI / 6;
        lantern.penumbra = 0.3;
        lantern.castShadow = true;
        camera.add(lantern);
        camera.add(lantern.target);
        lantern.target.position.set(0, 0, -1);
        scene.add(camera);

        const ambient = new THREE.AmbientLight(0x404040, 0.1);
        scene.add(ambient);

        // --- CEN√ÅRIO (Esgoto Infinito) ---
        const textureLoader = new THREE.TextureLoader();
        const wallTex = textureLoader.load('https://threejs.org/examples/textures/brick_diffuse.jpg');
        wallTex.wrapS = wallTex.wrapT = THREE.RepeatWrapping;
        wallTex.repeat.set(5, 1);

        const wallMat = new THREE.MeshStandardMaterial({ map: wallTex, color: 0x444444 });
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.1 });

        // Criar Corredores
        function createTunnel(z) {
            const tunnel = new THREE.Group();
            
            // Ch√£o
            const floor = new THREE.Mesh(new THREE.BoxGeometry(10, 0.1, 50), floorMat);
            floor.position.y = -2;
            floor.receiveShadow = true;
            tunnel.add(floor);

            // Teto
            const ceil = new THREE.Mesh(new THREE.BoxGeometry(10, 0.1, 50), wallMat);
            ceil.position.y = 4;
            tunnel.add(ceil);

            // Paredes
            const wallL = new THREE.Mesh(new THREE.BoxGeometry(0.1, 6, 50), wallMat);
            wallL.position.set(-5, 1, 0);
            tunnel.add(wallL);

            const wallR = new THREE.Mesh(new THREE.BoxGeometry(0.1, 6, 50), wallMat);
            wallR.position.set(5, 1, 0);
            tunnel.add(wallR);

            tunnel.position.z = z;
            scene.add(tunnel);
        }

        for(let i=0; i<10; i++) createTunnel(-i * 50);

        // --- IT (PENNYWISE) ---
        const itGeometry = new THREE.SphereGeometry(0.5, 32, 32);
        const itMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        const pennywise = new THREE.PointLight(0xff0000, 10, 15);
        pennywise.add(new THREE.Mesh(itGeometry, itMaterial));
        pennywise.position.set(0, 0, -30);
        scene.add(pennywise);

        // --- ITENS (Barquinhos) ---
        const items = [];
        const boatGeo = new THREE.ConeGeometry(0.2, 0.5, 4);
        const boatMat = new THREE.MeshStandardMaterial({ color: 0xffffff });

        function spawnBoat() {
            const boat = new THREE.Mesh(boatGeo, boatMat);
            boat.position.set(Math.random()*8-4, -1.8, -Math.random()*300);
            scene.add(boat);
            items.push(boat);
        }
        for(let i=0; i<5; i++) spawnBoat();

        // --- L√ìGICA DE JOGO ---
        let collected = 0;
        let sanity = 100;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;

        const onKeyDown = (e) => {
            switch(e.code) {
                case 'KeyW': moveForward = true; break;
                case 'KeyS': moveBackward = true; break;
                case 'KeyA': moveLeft = true; break;
                case 'KeyD': moveRight = true; break;
            }
        };
        const onKeyUp = (e) => {
            switch(e.code) {
                case 'KeyW': moveForward = false; break;
                case 'KeyS': moveBackward = false; break;
                case 'KeyA': moveLeft = false; break;
                case 'KeyD': moveRight = false; break;
            }
        };
        document.addEventListener('keydown', onKeyDown);
        document.addEventListener('keyup', onKeyUp);

        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();

        function animate() {
            requestAnimationFrame(animate);

            if (controls.isLocked) {
                // Movimento
                velocity.x -= velocity.x * 10.0 * 0.016;
                velocity.z -= velocity.z * 10.0 * 0.016;

                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();

                if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * 0.016;
                if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * 0.016;

                controls.moveRight(-velocity.x * 0.016);
                controls.moveForward(-velocity.z * 0.016);

                // Persegui√ß√£o do Pennywise
                const distToIt = camera.position.distanceTo(pennywise.position);
                
                // Pennywise se aproxima lentamente
                const dirToPlayer = new THREE.Vector3().subVectors(camera.position, pennywise.position).normalize();
                pennywise.position.add(dirToPlayer.multiplyScalar(0.03 + (collected * 0.01)));
                
                // Oscila√ß√£o de Pennywise
                pennywise.position.y = Math.sin(Date.now() * 0.005) * 0.5;

                // Sanidade cai se ele estiver perto
                if(distToIt < 8) {
                    sanity -= 0.2;
                    document.getElementById('flash').style.opacity = (8 - distToIt) / 8;
                } else {
                    document.getElementById('flash').style.opacity = 0;
                }

                // Coleta de Itens
                items.forEach((boat, index) => {
                    if(camera.position.distanceTo(boat.position) < 2) {
                        scene.remove(boat);
                        items.splice(index, 1);
                        collected++;
                        document.getElementById('items').innerText = collected;
                        if(collected === 5) alert("VOC√ä ENCONTROU A SA√çDA... POR ENQUANTO.");
                    }
                    boat.rotation.y += 0.02;
                });

                // Game Over
                if(sanity <= 0 || distToIt < 1.5) {
                    alert("VOC√ä FLUTUOU TAMB√âM! üéà");
                    location.reload();
                }

                document.getElementById('sanity-bar').style.width = sanity + "%";
            }

            renderer.render(scene, camera);
        }

        animate();

        // Ajuste de Janela
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
