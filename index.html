<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>VAMOS FLUTUAR ðŸŽˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Creepster&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
    * { box-sizing: border-box; touch-action: none; user-select: none; }
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; font-family: 'Press Start 2P', cursive; }
    #canvas-container { position: relative; width: 100vw; height: 100vh; max-width: 400px; max-height: 700px; border: 2px solid #333; }
    canvas { width: 100%; height: 100%; background: #050005; image-rendering: pixelated; }
    
    /* HUD */
    #hud { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; color: white; font-size: 10px; pointer-events: none; z-index: 10; }
    
    /* TELA DE INICIO (OVERLAY) */
    #overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 20; text-align: center; }
    .title { font-family: 'Creepster', serif; color: red; font-size: 40px; margin-bottom: 20px; text-shadow: 0 0 10px red; }
    .btn-start { background: red; color: white; border: none; padding: 15px 30px; font-family: 'Press Start 2P'; font-size: 12px; cursor: pointer; border-radius: 5px; }
    
    /* LOJA */
    #shop-ui { position: absolute; inset: 0; background: #000; display: none; flex-direction: column; padding: 20px; z-index: 30; color: white; overflow-y: auto; }
</style>
</head>
<body>

<div id="canvas-container">
    <div id="hud">
        <div id="score">0</div>
        <div id="coins" style="color: gold;">$0</div>
    </div>

    <div id="overlay">
        <div class="title">IT: FLUTUAR</div>
        <button class="btn-start" onclick="startGame()">JOGAR</button>
        <p style="color: #666; font-size: 8px; margin-top: 20px;">TOQUE PARA SUBIR</p>
        <button onclick="toggleShop(true)" style="background:none; border:1px solid #444; color:#aaa; font-size:8px; padding:10px; margin-top:20px;">LOJA</button>
    </div>

    <div id="shop-ui">
        <h2 style="color:red; font-family:'Creepster'; text-align:center;">LOJA</h2>
        <div id="shop-items"></div>
        <button onclick="toggleShop(false)" style="margin-top:20px; padding:10px; background:#333; color:white; border:none; font-family:inherit;">VOLTAR</button>
    </div>

    <canvas id="game"></canvas>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const hudScore = document.getElementById('score');
const hudCoins = document.getElementById('coins');

// ConfiguraÃ§Ã£o fixa para evitar erros de renderizaÃ§Ã£o
canvas.width = 320;
canvas.height = 480;

let gameActive = false;
let score = 0;
let coins = parseInt(localStorage.getItem('it_coins')) || 0;
let speed = 2;
let frames = 0;

// Player
const player = { x: 50, y: 200, vy: 0, w: 20, h: 30 };

// Entidades
let obstacles = [];
let pickups = [];

// Cores de BalÃ£o (Loja)
let ownedBalloons = JSON.parse(localStorage.getItem('it_balloons')) || ['#ff0000'];
let currentBalloon = localStorage.getItem('it_current') || '#ff0000';

const shopData = [
    { name: 'SANGUE', color: '#ff0000', price: 0 },
    { name: 'AZUL', color: '#0000ff', price: 100 },
    { name: 'VERDE', color: '#00ff00', price: 250 },
    { name: 'DOURADO', color: '#ffd700', price: 500 },
    { name: 'NEON', color: '#ff00ff', price: 1000 }
];

function save() {
    localStorage.setItem('it_coins', coins);
    localStorage.setItem('it_balloons', JSON.stringify(ownedBalloons));
    localStorage.setItem('it_current', currentBalloon);
    hudCoins.innerText = '$' + coins;
}

function startGame() {
    document.getElementById('overlay').style.display = 'none';
    resetGame();
    gameActive = true;
}

function resetGame() {
    player.y = 200;
    player.vy = 0;
    score = 0;
    speed = 2.5;
    obstacles = [];
    pickups = [];
    frames = 0;
    hudScore.innerText = '0';
    save();
}

function toggleShop(open) {
    const ui = document.getElementById('shop-ui');
    ui.style.display = open ? 'flex' : 'none';
    if(open) renderShop();
}

function renderShop() {
    const container = document.getElementById('shop-items');
    container.innerHTML = '';
    shopData.forEach(item => {
        const div = document.createElement('div');
        div.style = "display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #222;";
        const isOwned = ownedBalloons.includes(item.color);
        const isCurrent = currentBalloon === item.color;
        
        div.innerHTML = `
            <div style="display:flex; align-items:center;">
                <div style="width:15px; height:15px; background:${item.color}; border-radius:50%; margin-right:10px;"></div>
                <span style="font-size:8px;">${item.name}</span>
            </div>
            <button onclick="buyItem('${item.color}', ${item.price})" style="font-size:8px; padding:5px; background:${isCurrent?'#0f0':(isOwned?'#444':'red')}; color:white; border:none;">
                ${isCurrent ? 'USANDO' : (isOwned ? 'EQUIPAR' : '$'+item.price)}
            </button>
        `;
        container.appendChild(div);
    });
}

function buyItem(color, price) {
    if(ownedBalloons.includes(color)) {
        currentBalloon = color;
    } else if(coins >= price) {
        coins -= price;
        ownedBalloons.push(color);
        currentBalloon = color;
    } else {
        alert("MOEDAS INSUFICIENTES!");
    }
    save();
    renderShop();
}

// Input do Jogador
function jump() {
    if(!gameActive) return;
    player.vy = -4.5;
}

window.addEventListener('mousedown', jump);
window.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); }, {passive: false});

function gameOver() {
    gameActive = false;
    document.getElementById('overlay').style.display = 'flex';
    document.querySelector('.title').innerText = "VOCÃŠ CAIU";
    save();
}

function loop() {
    ctx.fillStyle = '#050005';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if(gameActive) {
        frames++;
        speed += 0.0005;

        // FÃ­sica
        player.vy += 0.25;
        player.y += player.vy;

        if(player.y > canvas.height || player.y < -50) gameOver();

        // Gerar ObstÃ¡culos (Serras)
        if(frames % 100 === 0) {
            obstacles.push({ x: canvas.width, y: Math.random()*(canvas.height-100)+50, size: 15 });
        }

        // Gerar Moedas
        if(frames % 150 === 0) {
            pickups.push({ x: canvas.width, y: Math.random()*(canvas.height-100)+50 });
        }

        // Desenhar e mover obstÃ¡culos
        ctx.fillStyle = "#666";
        obstacles.forEach((obs, i) => {
            obs.x -= speed;
            ctx.beginPath();
            ctx.arc(obs.x, obs.y, obs.size, 0, Math.PI*2);
            ctx.fill();
            
            // ColisÃ£o
            if(Math.hypot(player.x - obs.x, player.y - obs.y) < obs.size + 10) gameOver();
            if(obs.x < -20) obstacles.splice(i, 1);
        });

        // Desenhar e mover moedas
        ctx.fillStyle = "gold";
        pickups.forEach((p, i) => {
            p.x -= speed;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 6, 0, Math.PI*2);
            ctx.fill();
            
            if(Math.hypot(player.x - p.x, player.y - p.y) < 20) {
                coins += 1;
                score += 10;
                hudScore.innerText = score;
                hudCoins.innerText = '$' + coins;
                pickups.splice(i, 1);
            }
            if(p.x < -20) pickups.splice(i, 1);
        });

        // Desenhar Pennywise
        ctx.save();
        ctx.translate(player.x, player.y);
        
        // BalÃ£o
        ctx.strokeStyle = "white";
        ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0, -25); ctx.stroke();
        ctx.fillStyle = currentBalloon;
        ctx.beginPath(); ctx.ellipse(0, -30, 8, 10, 0, 0, Math.PI*2); ctx.fill();
        
        // PalhaÃ§o (Simples)
        ctx.fillStyle = "white"; ctx.fillRect(-8, -5, 16, 16); // CabeÃ§a
        ctx.fillStyle = "red"; ctx.fillRect(-2, -1, 4, 4); // Nariz
        ctx.fillStyle = "#ccc"; ctx.fillRect(-8, 11, 16, 12); // Roupa
        ctx.restore();

    } else {
        // Pennywise parado no menu
        ctx.save();
        ctx.translate(player.x, player.y);
        ctx.fillStyle = currentBalloon;
        ctx.beginPath(); ctx.ellipse(0, -30, 8, 10, 0, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "white"; ctx.fillRect(-8, -5, 16, 16);
        ctx.restore();
    }

    requestAnimationFrame(loop);
}

// Iniciar
hudCoins.innerText = '$' + coins;
loop();
</script>
</body>
</html>
